# ST-Statistics（SillyTavern 聊天统计扩展）

面向 SillyTavern 的聊天统计与可视化扩展，提供清晰直观的聊天分析面板。

## 主要功能

- 📊 **统计概览**：用户/AI 消息数、字数、Token 等关键指标
- 🗓️ **每日活跃度**：从开始至今的聊天活跃趋势
- ⏳ **时长统计**：总时长仪表盘 + 每日时长柱状图
- ⏰ **24 小时分布**：全天时段活跃热力图与趋势折线
- 🤖 **模型偏好**：统计 AI 回复所使用的模型占比
- 🎨 **主题切换**：内置多种配色方案，一键切换
- 📷 **一键导出**：将统计面板保存为 PNG 图片
- 💾 **结果缓存**：减少重复计算，加快二次查看

## 安装

1. 将本项目文件夹复制到 SillyTavern 的扩展目录：
	SillyTavern/public/scripts/extensions/
2. 重启 SillyTavern
3. 在扩展菜单中启用并使用

## 使用方法

1. 在 SillyTavern 中选择角色或群聊
2. 打开扩展菜单（魔法棒图标）
3. 点击「聊天统计报告」
4. 等待分析完成，查看统计面板
5. 如需保存，点击下载按钮导出图片

## 统计口径说明

- **用户输入 Token**：按用户输入字数估算，使用中文约 $1.5$ 字/Token 的换算方式
- **AI 输出 Token**：优先使用消息记录中的实际 Token 统计
- **时长统计**：以当天第一条与最后一条消息的时间差估算，每个聊天记录独立统计后汇总

## 开发与构建

```bash
# 安装依赖
npm install

# 开发模式（监听变更）
npm run dev

# 生产构建
npm run build
```

## 目录结构

- src/analyzer.js：统计口径与数据分析
- src/ui.js：面板 UI 与交互
- src/api.js：与 SillyTavern 的接口交互
- src/index.js：扩展入口

## 许可证

AGPL-3.0
